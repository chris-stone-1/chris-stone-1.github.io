<!DOCTYPE html>
<html>

<head>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>

<div id="container" style="min-width: 310px; height: 500px; margin: 0 auto"></div>



</head>

<body onload="WTCall()">

<script>



function WTCall() {

xmlhttp = new XMLHttpRequest();
var url = "https://bnnq37uk24.execute-api.eu-west-1.amazonaws.com/Prod/cpvisits-today";
xmlhttp.open("GET", url, true);
xmlhttp.setRequestHeader("Content-type", "application/json");
xmlhttp.onreadystatechange = function () {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {


	var visits="<th>Domain</th><th>Time</th><th>Sessions</th></tr>"+xmlhttp.responseText.substring(xmlhttp.responseText.lastIndexOf("&nbsp;</td></tr><tr><td>www.b")+16,xmlhttp.responseText.lastIndexOf("www.blackhorse.co.uk")+65);
    var data = +visits.substring(visits.split("00</td><td>", 1).join("00</td><td>").length+11,visits.split("00</td><td>", 2).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 2).join("00</td><td>").length+11,visits.split("00</td><td>", 3).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 3).join("00</td><td>").length+11,visits.split("00</td><td>", 4).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 4).join("00</td><td>").length+11,visits.split("00</td><td>", 5).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 5).join("00</td><td>").length+11,visits.split("00</td><td>", 6).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 6).join("00</td><td>").length+11,visits.split("00</td><td>", 7).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 7).join("00</td><td>").length+11,visits.split("00</td><td>", 8).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 8).join("00</td><td>").length+11,visits.split("00</td><td>", 9).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 9).join("00</td><td>").length+11,visits.split("00</td><td>", 10).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 10).join("00</td><td>").length+11,visits.split("00</td><td>", 11).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 11).join("00</td><td>").length+11,visits.split("00</td><td>", 12).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 12).join("00</td><td>").length+11,visits.split("00</td><td>", 13).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 13).join("00</td><td>").length+11,visits.split("00</td><td>", 14).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 14).join("00</td><td>").length+11,visits.split("00</td><td>", 15).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 15).join("00</td><td>").length+11,visits.split("00</td><td>", 16).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 16).join("00</td><td>").length+11,visits.split("00</td><td>", 17).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 17).join("00</td><td>").length+11,visits.split("00</td><td>", 18).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 18).join("00</td><td>").length+11,visits.split("00</td><td>", 19).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 19).join("00</td><td>").length+11,visits.split("00</td><td>", 20).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 20).join("00</td><td>").length+11,visits.split("00</td><td>", 21).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 21).join("00</td><td>").length+11,visits.split("00</td><td>", 22).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 22).join("00</td><td>").length+11,visits.split("00</td><td>", 23).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 23).join("00</td><td>").length+11,visits.split("00</td><td>", 24).join("00</td><td>").length-61)+","
        +visits.substring(visits.split("00</td><td>", 24).join("00</td><td>").length+11,visits.split("</td></tr>", 25).join("</td></tr>").length-10);

    var total = +visits.substring(visits.split("00</td><td>", 1).join("00</td><td>").length+11,visits.split("00</td><td>", 2).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 2).join("00</td><td>").length+11,visits.split("00</td><td>", 3).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 3).join("00</td><td>").length+11,visits.split("00</td><td>", 4).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 4).join("00</td><td>").length+11,visits.split("00</td><td>", 5).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 5).join("00</td><td>").length+11,visits.split("00</td><td>", 6).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 6).join("00</td><td>").length+11,visits.split("00</td><td>", 7).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 7).join("00</td><td>").length+11,visits.split("00</td><td>", 8).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 8).join("00</td><td>").length+11,visits.split("00</td><td>", 9).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 9).join("00</td><td>").length+11,visits.split("00</td><td>", 10).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 10).join("00</td><td>").length+11,visits.split("00</td><td>", 11).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 11).join("00</td><td>").length+11,visits.split("00</td><td>", 12).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 12).join("00</td><td>").length+11,visits.split("00</td><td>", 13).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 13).join("00</td><td>").length+11,visits.split("00</td><td>", 14).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 14).join("00</td><td>").length+11,visits.split("00</td><td>", 15).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 15).join("00</td><td>").length+11,visits.split("00</td><td>", 16).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 16).join("00</td><td>").length+11,visits.split("00</td><td>", 17).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 17).join("00</td><td>").length+11,visits.split("00</td><td>", 18).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 18).join("00</td><td>").length+11,visits.split("00</td><td>", 19).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 19).join("00</td><td>").length+11,visits.split("00</td><td>", 20).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 20).join("00</td><td>").length+11,visits.split("00</td><td>", 21).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 21).join("00</td><td>").length+11,visits.split("00</td><td>", 22).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 22).join("00</td><td>").length+11,visits.split("00</td><td>", 23).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 23).join("00</td><td>").length+11,visits.split("00</td><td>", 24).join("00</td><td>").length-61)+
        +visits.substring(visits.split("00</td><td>", 24).join("00</td><td>").length+11,visits.split("</td></tr>", 25).join("</td></tr>").length-10);
    var categories = "'12am','1am','2am','3am','4am','5am','6am','7am','8am','9am','10am','11am','12pm','1pm','2pm','3pm','4pm','5pm','6pm','7pm','8pm','9pm','10pm','11pm'"

	//console.log(visits);	
    console.log(data);
    console.log(categories);
    console.log(total);  

	//document.getElementById("datatable").innerHTML = visits;



Highcharts.chart('container', {
    chart: {
        type: 'area'
    },
    title: {
        text: 'Visits Today',
        style: {
            fontWeight: 'bold',
            fontSize: '28px'
        }
    },
    subtitle: {
        //text: 'Source: WorldClimate.com'
    },
    xAxis: {
        categories: [
        '12am',
        '1am',
        '2am',
        '3am',
        '4am',
        '5am',
        '6am',
        '7am',
        '8am',
        '9am',
        '10am',
        '11am',
        '12pm',
        '1pm',
        '2pm',
        '3pm',
        '4pm',
        '5pm',
        '6pm',
        '7pm',
        '8pm',
        '9pm',
        '10pm',
        '11pm'
        ],
        crosshair: true,
                labels: {
            style: {
                fontSize: '15px'
            }
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Visits',
            style: {
                fontWeight: 'bold',
                fontSize: '20px'
            }
        },
                labels: {
            style: {
                fontSize: '15px'
            }
        }
    },
    tooltip: {
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:.1f}</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true
    },
    plotOptions: {
        series: {
            animation: false
        }
    },
            legend: {
          borderRadius:0,
            backgroundColor: '#FFFFFF',
            itemMarginBottom: 7,
            layout: 'vertical',
            align: 'blahblah', //dunno why but removing this defaults it to top, crap value overlays it
            verticalAlign: 'top',                
            y: 130,
            x: 100,
            borderWidth: 0,
            width:210,
            symbolPadding: 10,
            useHTML:true,
            shadow: {
              color: '#000',
              width: 3,
              opacity: 0.15,
              offsetY: 2,
              offsetX: 1
            },
            labelFormatter: function() {
              return '<div class="' + this.name + '-arrow"></div><span style="font-family: \'Advent Pro\', sans-serif; font-size:20px">' + this.name +'</span><br/><span style="font-size:16px; color:#ababaa">(Total: ' + this.options.total + ')</span>';
        }

        },


    series: [{
        name: 'blackhorse.co.uk',
        total: JSON.parse("[" + total + "]"),
        data: JSON.parse("[" + data + "]"),  //this is the data formatted into an array which highcharts accepts, mimic again for another series
    }]
});

 
    }
}


xmlhttp.send();
    setTimeout(function () {
	WTCall();
    }, 60000);
}




</script>


</html>